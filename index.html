<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Tree Arrangement Editor</title>
    
    <!-- Split CSS files -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/toolbar.css">
    <link rel="stylesheet" href="css/canvas.css">
    <link rel="stylesheet" href="css/tree.css">
</head>
<body>
    <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
    <div class="top-toolbar">
        <div class="toolbar-group">
            <button class="btn btn-primary" onclick="exportCSV()">
                üì§ Export CSV
            </button>
            <button class="btn btn-success" onclick="importCSV()">
                üì• Import CSV
            </button>
            <input type="file" id="csvInput" accept=".csv" style="display: none">
        </div>
        
        <div class="toolbar-group">
            <button class="btn btn-primary" onclick="centerView()">
                üéØ Center View
            </button>
            <button class="btn btn-primary" onclick="toggleGrid()">
                üìè Toggle Grid
            </button>
            <button class="btn btn-primary" onclick="zoomIn()">
                üîç Zoom In
            </button>
            <button class="btn btn-primary" onclick="zoomOut()">
                üîé Zoom Out
            </button>
        </div>
        
        <div class="status-info">
            <span>Collisions: <span id="collisionCount" class="collision-warning">0</span></span>
            <span>| Selected: <span id="selectedTree">None</span></span>
            <span style="font-size: 12px; color: #ddd; margin-left: 10px;">
                üí° Use arrow keys to move the selected tree
            </span>
        </div>
    </div>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
    <div class="main-layout">
        <!-- Â∑¶‰æßÊ†ëÊìç‰ΩúÈù¢Êùø -->
        <div class="left-panel">
            <!-- Ê∑ªÂä†Âú£ËØûÊ†ë -->
            <div class="section">
                <div class="section-title">
                    üå≤ Add Christmas Tree
                </div>
                <div class="form-group">
                    <label>X Position:</label>
                    <input type="number" id="treeX" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>Y Position:</label>
                    <input type="number" id="treeY" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>Angle (¬∞):</label>
                    <input type="number" id="treeAngle" step="0.01" value="0">
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="addTree()">
                        ‚ûï Add Tree
                    </button>
                    <button class="btn btn-warning" onclick="addRandomTree()">
                        üé≤ Add Random
                    </button>
                </div>
            </div>

            <!-- Ê†ëÂàóË°® -->
            <div class="section">
                <div class="section-title">
                    üìã Tree List (Total <span id="treeCount">0</span> trees)
                </div>
                <div class="tree-list" id="treeList">
                    <!-- Ê†ëÈ°πÁõÆÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                    <!-- Tree items will be added dynamically by JS -->
                </div>
                <div class="btn-group">
                    <button class="btn btn-danger" onclick="clearAllTrees()">
                        üóëÔ∏è Clear All
                    </button>
                    <button class="btn btn-warning" onclick="removeSelectedTree()">
                        ‚úñÔ∏è Remove Selected
                    </button>
                </div>
            </div>

            <!-- Á¢∞ÊíûÊ£ÄÊµã -->
            <div class="section" id="collisionSection" style="display: none;">
                <div class="section-title">
                    ‚ö†Ô∏è Collision Detection
                </div>
                <div id="collisionInfo">
                    <!-- Collision information will be displayed here -->
                </div>
            </div>
        </div>

        <!-- ‰∏≠Èó¥ÁîªÂ∏ÉÂå∫Âüü -->
        <div class="canvas-area">
            <div class="canvas-container">
                <canvas id="treeCanvas"></canvas>
            </div>
        </div>

        <!-- Âè≥‰æßÁªüËÆ°Èù¢Êùø -->
        <div class="right-panel">
            <!-- ÁªüËÆ°‰ø°ÊÅØ -->
            <div class="section">
                <div class="section-title">
                    üìä Statistics
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Square Area</div>
                        <div class="stat-value" id="sideLength">0.000000000000000</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Score (Area / n)</div>
                        <div class="stat-value" id="score">0.000000000000000</div>
                    </div>
                </div>
            </div>

            <!-- Ê†ëËØ¶ÁªÜ‰ø°ÊÅØÈù¢ÊùøÔºàÊñ∞Â¢ûÔºâ -->
            <div class="section">
                <div class="section-title">
                    üìù Tree Details
                </div>
                <div id="treeDetails" class="details-panel">
                    <p style="color: #666; text-align: center; padding: 20px;">
                        Click a tree to view details<br>
                        <small style="color: #999; font-size: 12px;">
                            Tip: Use arrow keys to move the selected tree
                        </small>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Êåâ‰æùËµñÈ°∫Â∫èÂä†ËΩΩJavaScriptÊñá‰ª∂ -->
    <!-- Load JavaScript files in dependency order -->
    <!-- 1. Core classes -->
    <script src="classes.js"></script>
    
    <!-- 2. Utility libraries -->
    <script src="geometry.js"></script>
    
    <!-- 3. Canvas-related (split files) -->
    <script src="canvas-init.js"></script>
    <script src="grid-axes.js"></script>
    <script src="bounding-box.js"></script>
    <script src="drawing-core.js"></script>
    
    <!-- 4. Feature modules -->
    <script src="collision.js"></script>
    <script src="ui.js"></script>
    <script src="tree-operations.js"></script>
    <script src="file-operations.js"></script>
    <script src="interaction.js"></script>
    
    <!-- 5. Main entry -->
    <script src="main.js"></script>
    
    <script>
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (window.canvasInit && window.canvasInit.cleanupCanvas) {
                window.canvasInit.cleanupCanvas();
            }
        });
    </script>
</body>
</html>